<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Robot Arm 4 DOF Control</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            line-height: 1.5;
        }
        h1 {
            text-align: center;
        }
        .container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .controls, .status, .manual, .gripper, .speed {
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 10px;
        }
        h2 {
            margin-top: 0;
        }
        .controls {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
        }
        .controls button {
            flex: 1 1 100px;
            min-width: 80px;
            padding: 10px;
            font-size: 1rem;
            border-radius: 8px;
            cursor: pointer;
        }
        .status div, .manual div, .gripper div, .speed div {
            margin: 5px 0;
        }
        .manual div {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }
        .manual input[type="number"] {
            width: 60px;
            padding: 5px;
        }
        .manual button, .gripper input[type="range"], .speed input[type="range"] {
            cursor: pointer;
        }
        .gripper label, .speed label {
            display: block;
            margin-bottom: 5px;
        }

        /* Responsive adjustments */
        @media (max-width: 600px) {
            .controls button {
                flex: 1 1 45%;
                font-size: 0.9rem;
            }
            .manual div {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>


</head>
<body>

    <h1>Robot Arm 4 DOF Control</h1>

    <div class="speed">
        <h2>Arm Speed</h2>
        <div>
            <label for="speedSlider">Speed: <span id="speedValue">1.0</span></label>
            <input type="range" id="speedSlider" min="0.1" max="10" step="0.1" value="1">
        </div>
    </div>

    <div class="container">
        <div class="controls">
            <h2>Move Robot Arm in fixed axis</h2>
            <button id="xplus">X +</button>
            <button id="xminus">X -</button>
            <button id="yplus">Y +</button>
            <button id="yminus">Y -</button>
            <button id="zminus">Z -</button>
            <button id="zplus">Z +</button>
        </div>

    <div class="gripper">
        <h2>End-Effector Gripper</h2>
        <div>
            <label for="gripperSlider">Gripper Position: <span id="gripperValue">0</span></label>
            <input type="range" id="gripperSlider" min="0" max="1" step="0.01" value="0">
        </div>
    </div>

        <div class="status">
            <h2>Status</h2>
            <div>Desired Position: X=<span id="desX">0</span>, Y=<span id="desY">0</span>, Z=<span id="desZ">0</span></div>
            <div>Current Angles:
                <span id="angle0">0</span>,
                <span id="angle1">0</span>,
                <span id="angle2">0</span>,
                <span id="angle3">0</span>,
            </div>
        </div>

    </div>

    <script>
        ["xplus", "xminus", "yplus", "yminus", "zplus", "zminus"].forEach(id => {
            document.getElementById(id).addEventListener("click", async () => {
                try {
                    const response = await fetch(`/action/${id}`, { method: "POST" });
                    const data = await response.json();
                } catch (err) {
                    console.error(err);
                }
            });
        });

        const gripperSlider = document.getElementById("gripperSlider");
        const gripperValue = document.getElementById("gripperValue");

        gripperSlider.addEventListener("input", () => {
            const value = parseFloat(gripperSlider.value);
            gripperValue.innerText = value.toFixed(2);
            setGripper(value);
        });

        function setGripper(value) {
            fetch(`/set_gripper`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ position: value })
            }).catch(err => console.error(err));
        }

        const speedSlider = document.getElementById("speedSlider");
        const speedValue = document.getElementById("speedValue");

        speedSlider.addEventListener("input", () => {
            const value = parseFloat(speedSlider.value);
            speedValue.innerText = value.toFixed(1);
            setSpeed(value);
        });

        function setSpeed(value) {
            fetch(`/set_speed`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ speed: value })
            }).catch(err => console.error(err));
        }

        setInterval(async () => {
            const response = await fetch('/data/current', {
                method: "GET",
                headers: { "Content-Type": "application/json" }
            })
            const data = await response.json()
            updateStatus(data)
        }, 1000)

        function updateStatus(data){
            if(data.desiredPosition){
                document.getElementById("desX").innerText = data.desiredPosition?.[0];
                document.getElementById("desY").innerText = data.desiredPosition?.[1];
                document.getElementById("desZ").innerText = data.desiredPosition?.[2];
            }
            if(data.currentAngles){
                for(let i=0;i<4;i++){
                    document.getElementById(`angle${i}`).innerText = data.currentAngles[i];
                }
            }
        }
    </script>

</body>
</html>
